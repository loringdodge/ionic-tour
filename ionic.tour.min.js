!function(t){angular.module("ionic.tour",[]).factory("$ionicTour",["$rootScope","$compile","$timeout","$window","$q","$ionicTemplateLoader","$ionicBody","$ionicPosition","$ionicScrollDelegate",function(o,n,e,r,i,s,u,a,l){var p=[],f=function(t,o){return o>=t?function(n){return t+(o-t)*n}:function(n){return t-(t-o)*n}},c=function(t,o){return Math.abs(t-o)/.5},_=function(t,o){var n;return n="function"==typeof t.currentStyle?t.currentStyle[o]:"function"==typeof window.getComputedStyle?t.ownerDocument.defaultView.getComputedStyle(t,null)[o]:t.style[o],""===n?void 0:n},d=t.views.View.inherit({initialize:function(o){o=t.extend({},o),t.extend(this,o)},start:function(o){var n=this;o=o||{autoplay:!0},l.freezeScroll(!0),u.append(n._$tourtipEl),n._tourtipOffset=a.offset(n._$tourtipEl),n._arrowStyles={color:_(n._arrowEl,"borderBottomColor"),top:_(n._arrowEl,"top")};for(var r=0;r<p.length;r++){var i=a.offset(p[r]);t.extend(p[r],{offset:i,scrollDiff:0})}e(function(){n._$tourtipEl.addClass("slide-in-up ng-enter active")}),o.autoplay&&n.next()},finish:function(t){var o=this,n=o._index,e=o._steps[n],r=o._tourtipEl;t=t||{destroy:!0},l.freezeScroll(!1),o._orientation="next",e.onLeave(e[0],r),o._index=-1,o.scope.$parent&&o.scope.$parent.$broadcast("tourFinished"),t.destroy&&o.scope.$destroy(),r.remove()},goToStep:function(t,o){var n=this,e=n._steps[t],r=n._tourtipEl;o=o||e.onLeave,n._isRunning||(n._isRunning=!0,n._isFirst=0===t,n._isLast=t===n._steps.length-1,o(),e.onEnter(e,r),n.animateStep(t).then(function(){n._isRunning=!1}))},reset:function(){var t=this,o=t._index,n=t._steps[o],e=t._tourtipEl;t._orientation="next",o=0,t.goToStep(o,function(){n.onLeave(n[0],e)})},step:function(t){var o=this,n=o._index,e=o._steps[n],r=o._tourtipEl;return n=--t,0>n?void o.scope.$parent.$broadcast("tourAtStart"):n>=o._steps.length?void o.scope.$parent.$broadcast("tourAtEnd"):(o._orientation="next",void o.goToStep(n,function(){e.onLeave(e[0],r)}))},next:function(){var t=this,o=t._index,n=t._steps[o],e=t._tourtipEl;return t._orientation="next",o++,o>=t._steps.length?void t.scope.$parent.$broadcast("tourAtEnd"):void t.goToStep(o,function(){o-1>-1&&t._steps[o-1].onLeave(n[0],e)})},previous:function(){var t=this,o=t._index,n=t._steps[o],e=t._tourtipEl;return t._orientation="previous",o--,0>o?void t.scope.$parent.$broadcast("tourAtStart"):void t.goToStep(o,function(){o+1<t._steps.length&&n.onLeave(n[0],e)})},animateStep:function(t){var o=this;o._index=t;var n=o._index,e=o._steps[n],r=o._tourtipEl,s=o._tourtipOffset,u=o._windowOffset,a=o._arrowEl,p=(o._arrowStyles,l.getScrollView()),_=e.offset.top+e.offset.height+20,d=e.offset.left+e.offset.width/2-(u.width-s.width)/2,h=0;"undefined"!=typeof e.scrollDiff&&l.scrollBy(0,-e.scrollDiff,!0),_>u.height&&(h=Math.min(_-u.height,p.__maxScrollTop),l.scrollBy(0,h,!0),o._steps[n-1].scrollDiff=h),_+s.height>u.height?(_=e.offset.top-s.height-h-20,o.styleArrow("bottom")):o.styleArrow("top");var w=f(s.top,_),v=f(s.left,d),y=c(s.top,_);s.top=_,s.left=d;var S=i.defer();collide.animation({duration:y,percent:0,reverse:!1}).easing({type:"spring",frequency:5,friction:250,initialForce:!1}).on("start",function(){e.onStart(e[0],r)}).on("step",function(t){e.onTransition(t,e[0],r),r.style.transform=r.style.webkitTransform="translate3d(0,"+w(t)+"px,0)",a.style.transform=o._arrowEl.style.webkitTransform="translate3d("+v(t)+"px,0,0)"}).on("complete",function(){e.onEnd(e[0],r),S.resolve()}).start();return S.promise},styleArrow:function(t){var o=this;t=t||"top";var n=o._arrowEl,e=o._arrowStyles;"top"===t?(n.style.top=e.top,n.style.borderTopColor="transparent",n.style.borderBottomColor=e.color,o._arrowStyle="top"):"bottom"===t?(n.style.top="100%",n.style.borderTopColor=e.color,n.style.borderBottomColor="transparent",o._arrowStyle="bottom"):"none"===t&&(n.style.display="none",o._arrowStyle="none")},isRunning:function(){return!!this._isRunning},isShown:function(){return!!this._isShown},_arrowEl:null,_$arrowEl:null,_arrowStyles:{},_el:null,_$el:null,_index:-1,_isFirst:!1,_isLast:!1,_isRunning:!1,_isShown:!1,_orientation:"next",_steps:[],_scrollDiff:0,_tourtipEl:null,_$tourtipEl:null,_tourtipOffset:{},_windowOffset:{}}),h=function(e,s){var u=s.scope&&s.scope.$new()||o.$new(!0);s.viewType="tour",t.extend(u,{$hasHeader:!1,$hasSubheader:!1,$hasFooter:!1,$hasSubfooter:!1,$hasTabs:!1,$hasTabsTop:!1});var a=n('<div class="ion-tourtip">'+e+"</div>")(u);p.sort(function(t,o){return t.step-o.step}),s._steps=p,s._windowOffset={height:r.innerHeight,width:r.innerWidth},s._$el=a,s._el=a[0],s._tourtipEl=s._el.querySelector("tourtip"),s._$tourtipEl=angular.element(s._tourtipEl),s._tourtipOffset={top:0,left:0},s._arrowEl=s._tourtipEl.querySelector("tourtip-arrow"),s._$arrowEl=angular.element(s._arrowEl),s.tour=l;var l=new d(s);return l.scope=u,s.scope||(u[s.tour]=l),i.when(l)};return{fromTemplateUrl:function(t,o){if(!t)throw"A template was not defined.";if(!o)throw"Options are not defined.";return s.load(t).then(function(t){var n=h(t,o);return n})},registerStep:function(t){p.push(t)}}}]).directive("tourStep",["$timeout","$ionicTour",function(o,n){return{restrict:"A",scope:{tourOnStart:"=",tourOnEnd:"=",tourOnTransition:"=",tourOnEnter:"=",tourOnLeave:"="},link:function(e,r,i){t.extend(r,{step:i.tourStep,onStart:function(t,n){"function"==typeof e.tourOnStart&&o(function(){e.tourOnStart(t,n)})},onEnd:function(t,n){"function"==typeof e.tourOnEnd&&o(function(){e.tourOnEnd(t,n)})},onTransition:function(t,n,r){"function"==typeof e.tourOnTransition&&o(function(){e.tourOnTransition(t,n,r)})},onEnter:function(t,n){"function"==typeof e.tourOnEnter&&o(function(){e.tourOnEnter(t,n)})},onLeave:function(t,n){"function"==typeof e.tourOnLeave&&o(function(){e.tourOnLeave(t,n)})}}),n.registerStep(r)}}}])}(window.ionic);